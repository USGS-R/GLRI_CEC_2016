

```{r setup, include=FALSE}
library(knitr)
library(rmarkdown)
options(continue=" ")
options(width=60)
knitr::opts_chunk$set(echo = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      fig.height = 7,
                      fig.width = 9)
```


Number of individual chemicals with at least one sample that resulted in an exposure activity ratio > 10-3 for each site.



```{r }
library(toxEval)
library(dplyr)
library(ggplot2)
library(grid)

ACClong <- get_ACC(chem_info$CAS)
ACClong <- remove_flags(ACClong)

cleaned_ep <- clean_endPoint_info(endPointInfo)
filtered_ep <- filter_groups(cleaned_ep)

chemicalSummary <- get_chemical_summary(ACClong,
                                        filtered_ep,
                                        chem_data, 
                                        site_info, 
                                        chem_info)

threshold <- 10^-3

graphData <- chemicalSummary %>%
  group_by(site, date, chnm) %>% 
  summarize(sumEAR = sum(EAR)) %>%
  group_by(site, chnm) %>%
  summarize(maxEAR = max(sumEAR),
            count = n()) %>%
  group_by(site, count) %>%
  summarize(nChem = sum(maxEAR > threshold)) %>%
  data.frame() 

countPlot <- ggplot(graphData, aes(x=site))+
  geom_bar(aes(y=nChem),
           stat = "identity",
           fill = "steelblue") +
  geom_text(aes(y=-1, label =  count), size = 2.5) +
  theme_bw() +
  xlab("") +
  ylab("Number of Chemicals\n with EARmax > 0.001") +
  theme(axis.text.x = element_text( angle = 90,vjust=0.5,hjust = 1)) +
  theme(strip.text.y = element_text(angle=0, hjust=0, size=7), 
        strip.text.x = element_text(size = 8),
        strip.background = element_rect(fill="transparent", colour = NA),
        axis.text = element_text(size=8),
        panel.spacing = unit(0.05, "lines"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        plot.background = element_rect(fill = "transparent",colour = NA))

countPlot

```


